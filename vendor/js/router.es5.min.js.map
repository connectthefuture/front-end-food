{"version":3,"sources":["router.es5.js"],"names":["controllerProviderDecorator","$controllerProvider","$controllerIntrospectorProvider","register","name","ctrl","apply","this","arguments","controllers","onControllerRegistered","constructor","angular","isArray","length","$routeConfig","push","config","$get","$componentLoader","newOnControllerRegistered","component","rule","pop","routerFactory","$$rootRouter","$rootScope","$location","$$grammar","$controllerIntrospector","$watch","path","newUrl","navigate","nav","url","call","then","ngViewportDirective","$animate","$injector","$q","$router","invoke","method","context","instruction","locals","viewportLink","scope","$element","attrs","ctrls","$transclude","cleanupLastView","previousLeaveAnimation","cancel","currentScope","$destroy","currentElement","leave","newScope","currentController","previousInstruction","viewportName","ngViewport","parentCtrl","myCtrl","router","$$router","rootRouter","registerViewport","canDeactivate","activate","nextInstruction","serializeInstruction","$scope","$new","$$template","template","componentName","clone","enter","newController","controller","result","deactivate","when","activationResult","JSON","stringify","params","Object","keys","reduce","acc","key","restrict","transclude","terminal","priority","require","link","controllerAs","ngViewportFillContentDirective","$compile","html","contents","makeComponentString","join","ngLinkDirective","$parse","ngLinkDirectiveLinkFn","elt","ngLink","parts","match","LINK_MICROSYNTAX_RE","routeName","routeParams","routeParamsGetter","constant","generate","attr","anchorLinkDirective","element","nodeName","toLowerCase","hrefAttrName","prototype","toString","prop","on","event","href","preventDefault","recognize","setupRoutersStepFactory","makeDescendantRouters","initLocalsStepFactory","traverseInstruction","$routeParams","initControllersStepFactory","$controller","controllerName","e","console","warn","noop","runCanDeactivateHookStepFactory","canDeactivatePorts","runCanActivateHookStepFactory","canActivate","loadTemplatesStepFactory","$templateRequest","componentTemplateUrl","templateHtml","activateStepValue","activatePorts","pipelineProvider","stepConfiguration","protoStepConfiguration","steps","slice","newConfig","map","step","get","process","processOne","shift","$componentLoaderProvider","DEFAULT_SUFFIX","componentToCtrl","toUpperCase","substr","componentToTemplate","dashName","dashCase","ctrlToComponent","setCtrlNameMapping","newFn","setComponentFromCtrlMapping","setTemplateMapping","privatePipelineFactory","$pipeline","str","replace","$1","module","factory","value","provider","directive","$inject","$$pipeline","createClass","ctor","object","staticObject","superClass","$defineProperty","configurable","enumerable","writable","__proto__","$create","getProtoParent","getDescriptors","$defineProperties","TypeError","descriptors","names","$getOwnPropertyNames","i","$getOwnPropertyDescriptor","superDescriptor","homeObject","proto","$getPrototypeOf","superCall","self","args","superGet","descriptor","forEach","obj","fn","mapObjAsync","all","mapObj","boolToPromise","reject","defineProperty","defineProperties","create","getOwnPropertyDescriptor","getOwnPropertyNames","getPrototypeOf","Router","grammar","pipeline","parent","navigating","ports","children","registry","childRouter","ChildRouter","view","renavigate","mapping","$__0","lastNavigationAttempt","_startNavigating","_finishNavigating","canonicalUrl","traverseInstructionSync","childInstruction","viewports","queryViewports","port","traversePorts","child","renavigateDestination","previousUrl","Grammar","Pipeline","$traceurRuntime","type","string","RootRouter","$RootRouter","$ChildRouter","copy","parse","RouteRecognizer","test","StaticSegment","DynamicSegment","StarSegment","EpsilonSegment","route","types","charAt","segments","split","results","l","segment","dynamics","stars","statics","State","charSpec","nextStates","sortSolutions","states","sort","a","b","recognizeChar","ch","state","concat","RecognizeResults","queryParams","findHandler","handlers","regex","captures","currentCapture","handler","j","m","isDynamic","addSegment","currentState","eachChar","put","Target","matcher","delegate","Matcher","target","routes","generateMatch","startingPath","nestedCallback","fullPath","addRoute","routeArray","len","eachRoute","baseRoute","callback","binding","hasOwnProperty","to","willAddRoute","add","Error","addChild","contextEntered","addRouteCallback","specials","escapeRegex","RegExp","validChars","invalidChars","repeat","isEqual","chars","returned","indexOf","oCreate","F","splice","Array","rootState","options","allSegments","isEmpty","as","handlersFor","hasRoute","output","generateQueryString","pairs","pair","encodeURIComponent","arrayPair","parseQueryString","queryString","decodeURIComponent","keyLength","pathLen","queryStart","isSlashDropped","decodeURI","solutions","source","VERSION","CHILD_ROUTE_SUFFIX","rules","CanonicalRecognizer","componentRecognizer","lastContextChunk","lastHandler","lastParams","childRoute","childUrl","rewroteUrl","components","solution","recognizer","rewrites","configOne","getCanonicalUrl","toUrl","fromUrl","redirectTo","default","aliases","alias","withChild"],"mappings":"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","file":"router.es5.min.js","sourcesContent":["'use strict';\n\n/*\n * A module for adding new a routing system Angular 1.\n */\nangular.module('ngNewRouter', [])\n  .factory('$router', routerFactory)\n  .value('$routeParams', {})\n  .provider('$componentLoader', $componentLoaderProvider)\n  .provider('$pipeline', pipelineProvider)\n  .factory('$$pipeline', privatePipelineFactory)\n  .factory('$setupRoutersStep', setupRoutersStepFactory)\n  .factory('$initLocalsStep', initLocalsStepFactory)\n  .factory('$initControllersStep', initControllersStepFactory)\n  .factory('$runCanDeactivateHookStep', runCanDeactivateHookStepFactory)\n  .factory('$runCanActivateHookStep', runCanActivateHookStepFactory)\n  .factory('$loadTemplatesStep', loadTemplatesStepFactory)\n  .value('$activateStep', activateStepValue)\n  .directive('ngViewport', ngViewportDirective)\n  .directive('ngViewport', ngViewportFillContentDirective)\n  .directive('ngLink', ngLinkDirective)\n  .directive('a', anchorLinkDirective)\n\n\n\n\n/*\n * A module for inspecting controller constructors\n */\nangular.module('ng')\n  .provider('$controllerIntrospector', $controllerIntrospectorProvider)\n  .config(controllerProviderDecorator);\n\n/*\n * decorates with routing info\n */\nfunction controllerProviderDecorator($controllerProvider, $controllerIntrospectorProvider) {\n  var register = $controllerProvider.register;\n  $controllerProvider.register = function (name, ctrl) {\n    $controllerIntrospectorProvider.register(name, ctrl);\n    return register.apply(this, arguments);\n  };\n}\ncontrollerProviderDecorator.$inject = [\"$controllerProvider\", \"$controllerIntrospectorProvider\"];\n\n/*\n * private service that holds route mappings for each controller\n */\nfunction $controllerIntrospectorProvider() {\n  var controllers = [];\n  var onControllerRegistered = null;\n  return {\n    register: function (name, constructor) {\n      if (angular.isArray(constructor)) {\n        constructor = constructor[constructor.length - 1];\n      }\n      if (constructor.$routeConfig) {\n        if (onControllerRegistered) {\n          onControllerRegistered(name, constructor.$routeConfig);\n        } else {\n          controllers.push({name: name, config: constructor.$routeConfig});\n        }\n      }\n    },\n    $get: ['$componentLoader', function ($componentLoader) {\n      return function (newOnControllerRegistered) {\n        onControllerRegistered = function (name, constructor) {\n          name = $componentLoader.component(name);\n          return newOnControllerRegistered(name, constructor);\n        };\n        while(controllers.length > 0) {\n          var rule = controllers.pop();\n          onControllerRegistered(rule.name, rule.config);\n        }\n      }\n    }]\n  }\n}\n\nfunction routerFactory($$rootRouter, $rootScope, $location, $$grammar, $controllerIntrospector) {\n\n  $controllerIntrospector(function (name, config) {\n    $$grammar.config(name, config);\n  });\n\n  $rootScope.$watch(function () {\n    return $location.path();\n  }, function (newUrl) {\n    $$rootRouter.navigate(newUrl);\n  });\n\n  var nav = $$rootRouter.navigate;\n  $$rootRouter.navigate = function (url) {\n    return nav.call(this, url).then(function (newUrl) {\n      if (newUrl) {\n        $location.path(newUrl);\n      }\n    });\n  }\n\n  return $$rootRouter;\n}\nrouterFactory.$inject = [\"$$rootRouter\", \"$rootScope\", \"$location\", \"$$grammar\", \"$controllerIntrospector\"];\n\n/**\n * @name ngViewport\n *\n * @description\n * An ngViewport is where resolved content goes.\n *\n * ## Use\n *\n * ```html\n * <div router-viewport=\"name\"></div>\n * ```\n *\n * The value for the `ngViewport` attribute is optional.\n */\nfunction ngViewportDirective($animate, $injector, $q, $router) {\n  var rootRouter = $router;\n\n  return {\n    restrict: 'AE',\n    transclude: 'element',\n    terminal: true,\n    priority: 400,\n    require: ['?^^ngViewport', 'ngViewport'],\n    link: viewportLink,\n    controller: function() {},\n    controllerAs: '$$ngViewport'\n  };\n\n  function invoke(method, context, instruction) {\n    return $injector.invoke(method, context, instruction.locals);\n  }\n\n  function viewportLink(scope, $element, attrs, ctrls, $transclude) {\n    var viewportName = attrs.ngViewport || 'default',\n        parentCtrl = ctrls[0],\n        myCtrl = ctrls[1],\n        router = (parentCtrl && parentCtrl.$$router) || rootRouter;\n\n    var currentScope,\n        newScope,\n        currentController,\n        currentElement,\n        previousLeaveAnimation,\n        previousInstruction;\n\n    function cleanupLastView() {\n      if (previousLeaveAnimation) {\n        $animate.cancel(previousLeaveAnimation);\n        previousLeaveAnimation = null;\n      }\n\n      if (currentScope) {\n        currentScope.$destroy();\n        currentScope = null;\n      }\n      if (currentElement) {\n        previousLeaveAnimation = $animate.leave(currentElement);\n        previousLeaveAnimation.then(function() {\n          previousLeaveAnimation = null;\n        });\n        currentElement = null;\n      }\n    }\n\n    router.registerViewport({\n      canDeactivate: function(instruction) {\n        if (currentController && currentController.canDeactivate) {\n          return invoke(currentController.canDeactivate, currentController, instruction);\n        }\n        return true;\n      },\n      activate: function(instruction) {\n        var nextInstruction = serializeInstruction(instruction);\n        if (nextInstruction === previousInstruction) {\n          return;\n        }\n\n        instruction.locals.$scope = newScope = scope.$new();\n        myCtrl.$$router = instruction.router;\n        myCtrl.$$template = instruction.template;\n        var componentName = instruction.component;\n        var clone = $transclude(newScope, function(clone) {\n          $animate.enter(clone, null, currentElement || $element);\n          cleanupLastView();\n        });\n\n        var newController = instruction.controller;\n        newScope[componentName] = newController;\n\n        var result;\n        if (currentController && currentController.deactivate) {\n          result = $q.when(invoke(currentController.deactivate, currentController, instruction));\n        }\n\n        currentController = newController;\n\n        currentElement = clone;\n        currentScope = newScope;\n\n        previousInstruction = nextInstruction;\n\n        // finally, run the hook\n        if (newController.activate) {\n          var activationResult = $q.when(invoke(newController.activate, newController, instruction));\n          if (result) {\n            return result.then(activationResult);\n          } else {\n            return activationResult;\n          }\n        }\n        return result;\n      }\n    }, viewportName);\n  }\n\n  // TODO: how best to serialize?\n  function serializeInstruction(instruction) {\n    return JSON.stringify({\n      path: instruction.path,\n      component: instruction.component,\n      params: Object.keys(instruction.params).reduce(function (acc, key) {\n        return (key !== 'childRoute' && (acc[key] = instruction.params[key])), acc;\n      }, {})\n    });\n  }\n}\nngViewportDirective.$inject = [\"$animate\", \"$injector\", \"$q\", \"$router\"];\n\nfunction ngViewportFillContentDirective($compile) {\n  return {\n    restrict: 'EA',\n    priority: -400,\n    require: 'ngViewport',\n    link: function(scope, $element, attrs, ctrl) {\n      var template = ctrl.$$template;\n      $element.html(template);\n      var link = $compile($element.contents());\n      link(scope);\n    }\n  };\n}\nngViewportFillContentDirective.$inject = [\"$compile\"];\n\nfunction makeComponentString(name) {\n  return [\n    '<router-component component-name=\"', name, '\">',\n    '</router-component>'\n  ].join('');\n}\n\n\nvar LINK_MICROSYNTAX_RE = /^(.+?)(?:\\((.*)\\))?$/;\n/**\n * @name ngLink\n * @description\n * Lets you link to different parts of the app, and automatically generates hrefs.\n *\n * ## Use\n * The directive uses a simple syntax: `router-link=\"componentName({ param: paramValue })\"`\n *\n * ## Example\n *\n * ```js\n * angular.module('myApp', ['ngFuturisticRouter'])\n *   .controller('AppController', ['$router', function($router) {\n *     $router.config({ path: '/user/:id' component: 'user' });\n *     this.user = { name: 'Brian', id: 123 };\n *   });\n * ```\n *\n * ```html\n * <div ng-controller=\"AppController as app\">\n *   <a router-link=\"user({id: app.user.id})\">{{app.user.name}}</a>\n * </div>\n * ```\n */\nfunction ngLinkDirective($router, $location, $parse) {\n  var rootRouter = $router;\n\n  return {\n    require: '?^^ngViewport',\n    restrict: 'A',\n    link: ngLinkDirectiveLinkFn\n  };\n\n  function ngLinkDirectiveLinkFn(scope, elt, attrs, ctrl) {\n    var router = (ctrl && ctrl.$$router) || rootRouter;\n    if (!router) {\n      return;\n    }\n\n    var link = attrs.ngLink || '';\n    var parts = link.match(LINK_MICROSYNTAX_RE);\n    var routeName = parts[1];\n    var routeParams = parts[2];\n    var url;\n\n    if (routeParams) {\n      var routeParamsGetter = $parse(routeParams);\n      // we can avoid adding a watcher if it's a literal\n      if (routeParamsGetter.constant) {\n        var params = routeParamsGetter();\n        url = '.' + router.generate(routeName, params);\n        elt.attr('href', url);\n      } else {\n        scope.$watch(function() {\n          return routeParamsGetter(scope);\n        }, function(params) {\n          url = '.' + router.generate(routeName, params);\n          elt.attr('href', url);\n        }, true);\n      }\n    } else {\n      url = '.' + router.generate(routeName);\n      elt.attr('href', url);\n    }\n  }\n}\nngLinkDirective.$inject = [\"$router\", \"$location\", \"$parse\"];\n\n\nfunction anchorLinkDirective($router) {\n  return {\n    restrict: 'E',\n    link: function(scope, element) {\n      // If the linked element is not an anchor tag anymore, do nothing\n      if (element[0].nodeName.toLowerCase() !== 'a') return;\n\n      // SVGAElement does not use the href attribute, but rather the 'xlinkHref' attribute.\n      var hrefAttrName = Object.prototype.toString.call(element.prop('href')) === '[object SVGAnimatedString]' ?\n                     'xlink:href' : 'href';\n\n      element.on('click', function(event) {\n        var href = element.attr(hrefAttrName);\n        if (!href) {\n          event.preventDefault();\n        }\n        if ($router.recognize(href)) {\n          $router.navigate(href);\n          event.preventDefault();\n        }\n      });\n    }\n  }\n}\nanchorLinkDirective.$inject = [\"$router\"];\n\nfunction setupRoutersStepFactory() {\n  return function (instruction) {\n    return instruction.router.makeDescendantRouters(instruction);\n  }\n}\n\n/*\n * $initLocalsStep\n */\nfunction initLocalsStepFactory() {\n  return function initLocals(instruction) {\n    return instruction.router.traverseInstruction(instruction, function(instruction) {\n      return instruction.locals = {\n        $router: instruction.router,\n        $routeParams: (instruction.params || {})\n      };\n    });\n  }\n}\n\n/*\n * $initControllersStep\n */\nfunction initControllersStepFactory($controller, $componentLoader) {\n  return function initControllers(instruction) {\n    return instruction.router.traverseInstruction(instruction, function(instruction) {\n      var controllerName = $componentLoader.controllerName(instruction.component);\n      var locals = instruction.locals;\n      var ctrl;\n      try {\n        ctrl = $controller(controllerName, locals);\n      } catch(e) {\n        console.warn && console.warn('Could not instantiate controller', controllerName);\n        ctrl = $controller(angular.noop, locals);\n      }\n      return instruction.controller = ctrl;\n    });\n  }\n}\ninitControllersStepFactory.$inject = [\"$controller\", \"$componentLoader\"];\n\nfunction runCanDeactivateHookStepFactory() {\n  return function runCanDeactivateHook(instruction) {\n    return instruction.router.canDeactivatePorts(instruction);\n  };\n}\n\nfunction runCanActivateHookStepFactory($injector) {\n\n  function invoke(method, context, instruction) {\n    return $injector.invoke(method, context, {\n      $routeParams: instruction.params\n    });\n  }\n\n  return function runCanActivateHook(instruction) {\n    return instruction.router.traverseInstruction(instruction, function(instruction) {\n      var controller = instruction.controller;\n      return !controller.canActivate || invoke(controller.canActivate, controller, instruction);\n    });\n  }\n}\nrunCanActivateHookStepFactory.$inject = [\"$injector\"];\n\nfunction loadTemplatesStepFactory($componentLoader, $templateRequest) {\n  return function loadTemplates(instruction) {\n    return instruction.router.traverseInstruction(instruction, function(instruction) {\n      var componentTemplateUrl = $componentLoader.template(instruction.component);\n      return $templateRequest(componentTemplateUrl).then(function (templateHtml) {\n        return instruction.template = templateHtml;\n      });\n    });\n  };\n}\nloadTemplatesStepFactory.$inject = [\"$componentLoader\", \"$templateRequest\"];\n\n\nfunction activateStepValue(instruction) {\n  return instruction.router.activatePorts(instruction);\n}\n\n\nfunction pipelineProvider() {\n  var stepConfiguration;\n\n  var protoStepConfiguration = [\n    '$setupRoutersStep',\n    '$initLocalsStep',\n    '$initControllersStep',\n    '$runCanDeactivateHookStep',\n    '$runCanActivateHookStep',\n    '$loadTemplatesStep',\n    '$activateStep'\n  ];\n\n  return {\n    steps: protoStepConfiguration.slice(0),\n    config: function (newConfig) {\n      protoStepConfiguration = newConfig;\n    },\n    $get: [\"$injector\", \"$q\", function ($injector, $q) {\n      stepConfiguration = protoStepConfiguration.map(function (step) {\n        return $injector.get(step);\n      });\n      return {\n        process: function(instruction) {\n          // make a copy\n          var steps = stepConfiguration.slice(0);\n\n          function processOne(result) {\n            if (steps.length === 0) {\n              return result;\n            }\n            var step = steps.shift();\n            return $q.when(step(instruction)).then(processOne);\n          }\n\n          return processOne();\n        }\n      }\n    }]\n  };\n}\n\n\n/**\n * @name $componentLoaderProvider\n * @description\n *\n * This lets you configure conventions for what controllers are named and where to load templates from.\n *\n * The default behavior is to dasherize and serve from `./components`. A component called `myWidget`\n * uses a controller named `MyWidgetController` and a template loaded from `./components/my-widget/my-widget.html`.\n *\n * A component is:\n * - a controller\n * - a template\n * - an optional router\n *\n * This service makes it easy to group all of them into a single concept.\n */\nfunction $componentLoaderProvider() {\n\n  var DEFAULT_SUFFIX = 'Controller';\n\n  var componentToCtrl = function componentToCtrlDefault(name) {\n    return name[0].toUpperCase() + name.substr(1) + DEFAULT_SUFFIX;\n  };\n\n  var componentToTemplate = function componentToTemplateDefault(name) {\n    var dashName = dashCase(name);\n    return './components/' + dashName + '/' + dashName + '.html';\n  };\n\n  var ctrlToComponent = function ctrlToComponentDefault(name) {\n    return name[0].toLowerCase() + name.substr(1, name.length - DEFAULT_SUFFIX.length - 1);\n  };\n\n  return {\n    $get: function () {\n      return {\n        controllerName: componentToCtrl,\n        template: componentToTemplate,\n        component: ctrlToComponent\n      };\n    },\n\n    /**\n     * @name $componentLoaderProvider#setCtrlNameMapping\n     * @description takes a function for mapping component names to component controller names\n     */\n    setCtrlNameMapping: function(newFn) {\n      componentToCtrl = newFn;\n      return this;\n    },\n\n    /**\n     * @name $componentLoaderProvider#setCtrlNameMapping\n     * @description takes a function for mapping component controller names to component names\n     */\n    setComponentFromCtrlMapping: function (newFn) {\n      ctrlToComponent = newFn;\n      return this;\n    },\n\n    /**\n     * @name $componentLoaderProvider#setTemplateMapping\n     * @description takes a function for mapping component names to component template URLs\n     */\n    setTemplateMapping: function(newFn) {\n      componentToTemplate = newFn;\n      return this;\n    }\n  };\n}\n\n// this is a hack as a result of the build system used to transpile\nfunction privatePipelineFactory($pipeline) {\n  return $pipeline;\n}\nprivatePipelineFactory.$inject = [\"$pipeline\"];\n\n\nfunction dashCase(str) {\n  return str.replace(/([A-Z])/g, function ($1) {\n    return '-' + $1.toLowerCase();\n  });\n}\n\n\nangular.module('ngNewRouter').factory('$$rootRouter', ['$q', '$$grammar', '$$pipeline', function ($q, $$grammar, $$pipeline) {\n/*\n * artisinal, handcrafted subset of the traceur runtime for picky webdevs\n */\n\nvar $defineProperty = Object.defineProperty,\n    $defineProperties = Object.defineProperties,\n    $create = Object.create,\n    $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor,\n    $getOwnPropertyNames = Object.getOwnPropertyNames,\n    $getPrototypeOf = Object.getPrototypeOf;\n\nfunction createClass(ctor, object, staticObject, superClass) {\n  $defineProperty(object, 'constructor', {\n    value: ctor,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n  if (arguments.length > 3) {\n    if (typeof superClass === 'function')\n      ctor.__proto__ = superClass;\n    ctor.prototype = $create(getProtoParent(superClass), getDescriptors(object));\n  } else {\n    ctor.prototype = object;\n  }\n  $defineProperty(ctor, 'prototype', {\n    configurable: false,\n    writable: false\n  });\n  return $defineProperties(ctor, getDescriptors(staticObject));\n}\n\nfunction getProtoParent(superClass) {\n  if (typeof superClass === 'function') {\n    var prototype = superClass.prototype;\n    if (Object(prototype) === prototype || prototype === null)\n      return superClass.prototype;\n    throw new TypeError('super prototype must be an Object or null');\n  }\n  if (superClass === null)\n    return null;\n  throw new TypeError((\"Super expression must either be null or a function, not \" + typeof superClass + \".\"));\n}\n\nfunction getDescriptors(object) {\n  var descriptors = {};\n  var names = $getOwnPropertyNames(object);\n  for (var i = 0; i < names.length; i++) {\n    var name = names[i];\n    descriptors[name] = $getOwnPropertyDescriptor(object, name);\n  }\n  // TODO: someday you might use symbols and you'll have to re-evaluate\n  //       your life choices that led to the creation of this file\n\n  // var symbols = getOwnPropertySymbols(object);\n  // for (var i = 0; i < symbols.length; i++) {\n  //   var symbol = symbols[i];\n  //   descriptors[$traceurRuntime.toProperty(symbol)] = $getOwnPropertyDescriptor(object, $traceurRuntime.toProperty(symbol));\n  // }\n  return descriptors;\n}\nfunction superDescriptor(homeObject, name) {\n  var proto = $getPrototypeOf(homeObject);\n  do {\n    var result = $getOwnPropertyDescriptor(proto, name);\n    if (result)\n      return result;\n    proto = $getPrototypeOf(proto);\n  } while (proto);\n  return undefined;\n}\nfunction superCall(self, homeObject, name, args) {\n  return superGet(self, homeObject, name).apply(self, args);\n}\nfunction superGet(self, homeObject, name) {\n  var descriptor = superDescriptor(homeObject, name);\n  if (descriptor) {\n    if (!descriptor.get)\n      return descriptor.value;\n    return descriptor.get.call(self);\n  }\n  return undefined;\n}\n\n\"use strict\";\nvar Router = function Router(grammar, pipeline, parent, name) {\n    this.name = name;\n    this.parent = parent || null;\n    this.navigating = false;\n    this.ports = {};\n    this.children = {};\n    this.registry = grammar;\n    this.pipeline = pipeline;\n  };\n(createClass)(Router, {\n    childRouter: function() {\n      var name = arguments[0] !== (void 0) ? arguments[0] : 'default';\n      if (!this.children[name]) {\n        this.children[name] = new ChildRouter(this, name);\n      }\n      return this.children[name];\n    },\n    registerViewport: function(view) {\n      var name = arguments[1] !== (void 0) ? arguments[1] : 'default';\n      this.ports[name] = view;\n      return this.renavigate();\n    },\n    config: function(mapping) {\n      this.registry.config(this.name, mapping);\n      return this.renavigate();\n    },\n    navigate: function(url) {\n      var $__0 = this;\n      if (this.navigating) {\n        return $q.when();\n      }\n      this.lastNavigationAttempt = url;\n      var instruction = this.recognize(url);\n      if (!instruction) {\n        return $q.reject();\n      }\n      this._startNavigating();\n      instruction.router = this;\n      return this.pipeline.process(instruction).then((function() {\n        return $__0._finishNavigating();\n      }), (function() {\n        return $__0._finishNavigating();\n      })).then((function() {\n        return instruction.canonicalUrl;\n      }));\n    },\n    _startNavigating: function() {\n      this.navigating = true;\n    },\n    _finishNavigating: function() {\n      this.navigating = false;\n    },\n    makeDescendantRouters: function(instruction) {\n      this.traverseInstructionSync(instruction, (function(instruction, childInstruction) {\n        childInstruction.router = instruction.router.childRouter(childInstruction.component);\n      }));\n    },\n    traverseInstructionSync: function(instruction, fn) {\n      var $__0 = this;\n      forEach(instruction.viewports, (function(childInstruction, viewportName) {\n        return fn(instruction, childInstruction);\n      }));\n      forEach(instruction.viewports, (function(childInstruction) {\n        return $__0.traverseInstructionSync(childInstruction, fn);\n      }));\n    },\n    traverseInstruction: function(instruction, fn) {\n      if (!instruction) {\n        return $q.when();\n      }\n      return mapObjAsync(instruction.viewports, (function(childInstruction, viewportName) {\n        return boolToPromise(fn(childInstruction, viewportName));\n      })).then((function() {\n        return mapObjAsync(instruction.viewports, (function(childInstruction, viewportName) {\n          return childInstruction.router.traverseInstruction(childInstruction, fn);\n        }));\n      }));\n    },\n    activatePorts: function(instruction) {\n      return this.queryViewports((function(port, name) {\n        return port.activate(instruction.viewports[name]);\n      })).then((function() {\n        return mapObjAsync(instruction.viewports, (function(instruction) {\n          return instruction.router.activatePorts(instruction);\n        }));\n      }));\n    },\n    canDeactivatePorts: function(instruction) {\n      return this.traversePorts((function(port, name) {\n        return boolToPromise(port.canDeactivate(instruction.viewports[name]));\n      }));\n    },\n    traversePorts: function(fn) {\n      var $__0 = this;\n      return this.queryViewports(fn).then((function() {\n        return mapObjAsync($__0.children, (function(child) {\n          return child.traversePorts(fn);\n        }));\n      }));\n    },\n    queryViewports: function(fn) {\n      return mapObjAsync(this.ports, fn);\n    },\n    recognize: function(url) {\n      return this.registry.recognize(url);\n    },\n    renavigate: function() {\n      var renavigateDestination = this.previousUrl || this.lastNavigationAttempt;\n      if (!this.navigating && renavigateDestination) {\n        return this.navigate(renavigateDestination);\n      } else {\n        return $q.when();\n      }\n    },\n    generate: function(name, params) {\n      return this.registry.generate(name, params);\n    }\n  }, {});\nObject.defineProperty(Router, \"parameters\", {get: function() {\n      return [[Grammar], [Pipeline], [], []];\n    }});\nObject.defineProperty(Router.prototype.generate, \"parameters\", {get: function() {\n      return [[$traceurRuntime.type.string], []];\n    }});\nvar RootRouter = function RootRouter(grammar, pipeline) {\n    superCall(this, $RootRouter.prototype, \"constructor\", [grammar, pipeline, null, '/']);\n  };\nvar $RootRouter = RootRouter;\n(createClass)(RootRouter, {}, {}, Router);\nObject.defineProperty(RootRouter, \"parameters\", {get: function() {\n      return [[Grammar], [Pipeline]];\n    }});\nvar ChildRouter = function ChildRouter(parent, name) {\n    superCall(this, $ChildRouter.prototype, \"constructor\", [parent.registry, parent.pipeline, parent, name]);\n    this.parent = parent;\n  };\nvar $ChildRouter = ChildRouter;\n(createClass)(ChildRouter, {}, {}, Router);\nfunction forEach(obj, fn) {\n    Object.keys(obj).forEach((function(key) {\n      return fn(obj[key], key);\n    }));\n  }\nfunction mapObjAsync(obj, fn) {\n    return $q.all(mapObj(obj, fn));\n  }\nfunction mapObj(obj, fn) {\n    var result = [];\n    Object.keys(obj).forEach((function(key) {\n      return result.push(fn(obj[key], key));\n    }));\n    return result;\n  }\nfunction boolToPromise(value) {\n    return value ? $q.when(value) : $q.reject();\n  }\nreturn new RootRouter($$grammar, $$pipeline);\n}]);\n\n\nangular.module('ngNewRouter').factory('$$grammar', ['$q', function ($q) {\n/*\n * artisinal, handcrafted subset of the traceur runtime for picky webdevs\n */\n\nvar $defineProperty = Object.defineProperty,\n    $defineProperties = Object.defineProperties,\n    $create = Object.create,\n    $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor,\n    $getOwnPropertyNames = Object.getOwnPropertyNames,\n    $getPrototypeOf = Object.getPrototypeOf;\n\nfunction createClass(ctor, object, staticObject, superClass) {\n  $defineProperty(object, 'constructor', {\n    value: ctor,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n  if (arguments.length > 3) {\n    if (typeof superClass === 'function')\n      ctor.__proto__ = superClass;\n    ctor.prototype = $create(getProtoParent(superClass), getDescriptors(object));\n  } else {\n    ctor.prototype = object;\n  }\n  $defineProperty(ctor, 'prototype', {\n    configurable: false,\n    writable: false\n  });\n  return $defineProperties(ctor, getDescriptors(staticObject));\n}\n\nfunction getProtoParent(superClass) {\n  if (typeof superClass === 'function') {\n    var prototype = superClass.prototype;\n    if (Object(prototype) === prototype || prototype === null)\n      return superClass.prototype;\n    throw new TypeError('super prototype must be an Object or null');\n  }\n  if (superClass === null)\n    return null;\n  throw new TypeError((\"Super expression must either be null or a function, not \" + typeof superClass + \".\"));\n}\n\nfunction getDescriptors(object) {\n  var descriptors = {};\n  var names = $getOwnPropertyNames(object);\n  for (var i = 0; i < names.length; i++) {\n    var name = names[i];\n    descriptors[name] = $getOwnPropertyDescriptor(object, name);\n  }\n  // TODO: someday you might use symbols and you'll have to re-evaluate\n  //       your life choices that led to the creation of this file\n\n  // var symbols = getOwnPropertySymbols(object);\n  // for (var i = 0; i < symbols.length; i++) {\n  //   var symbol = symbols[i];\n  //   descriptors[$traceurRuntime.toProperty(symbol)] = $getOwnPropertyDescriptor(object, $traceurRuntime.toProperty(symbol));\n  // }\n  return descriptors;\n}\nfunction superDescriptor(homeObject, name) {\n  var proto = $getPrototypeOf(homeObject);\n  do {\n    var result = $getOwnPropertyDescriptor(proto, name);\n    if (result)\n      return result;\n    proto = $getPrototypeOf(proto);\n  } while (proto);\n  return undefined;\n}\nfunction superCall(self, homeObject, name, args) {\n  return superGet(self, homeObject, name).apply(self, args);\n}\nfunction superGet(self, homeObject, name) {\n  var descriptor = superDescriptor(homeObject, name);\n  if (descriptor) {\n    if (!descriptor.get)\n      return descriptor.value;\n    return descriptor.get.call(self);\n  }\n  return undefined;\n}\n\n\"use strict\";\nvar RouteRecognizer = (function() {\n    var map = (function() {\n      function Target(path, matcher, delegate) {\n        this.path = path;\n        this.matcher = matcher;\n        this.delegate = delegate;\n      }\n      Target.prototype = {to: function(target, callback) {\n          var delegate = this.delegate;\n          if (delegate && delegate.willAddRoute) {\n            target = delegate.willAddRoute(this.matcher.target, target);\n          }\n          this.matcher.add(this.path, target);\n          if (callback) {\n            if (callback.length === 0) {\n              throw new Error(\"You must have an argument in the function passed to `to`\");\n            }\n            this.matcher.addChild(this.path, target, callback, this.delegate);\n          }\n          return this;\n        }};\n      function Matcher(target) {\n        this.routes = {};\n        this.children = {};\n        this.target = target;\n      }\n      Matcher.prototype = {\n        add: function(path, handler) {\n          this.routes[path] = handler;\n        },\n        addChild: function(path, target, callback, delegate) {\n          var matcher = new Matcher(target);\n          this.children[path] = matcher;\n          var match = generateMatch(path, matcher, delegate);\n          if (delegate && delegate.contextEntered) {\n            delegate.contextEntered(target, match);\n          }\n          callback(match);\n        }\n      };\n      function generateMatch(startingPath, matcher, delegate) {\n        return function(path, nestedCallback) {\n          var fullPath = startingPath + path;\n          if (nestedCallback) {\n            nestedCallback(generateMatch(fullPath, matcher, delegate));\n          } else {\n            return new Target(startingPath + path, matcher, delegate);\n          }\n        };\n      }\n      function addRoute(routeArray, path, handler) {\n        var len = 0;\n        for (var i = 0,\n            l = routeArray.length; i < l; i++) {\n          len += routeArray[i].path.length;\n        }\n        path = path.substr(len);\n        var route = {\n          path: path,\n          handler: handler\n        };\n        routeArray.push(route);\n      }\n      function eachRoute(baseRoute, matcher, callback, binding) {\n        var routes = matcher.routes;\n        for (var path in routes) {\n          if (routes.hasOwnProperty(path)) {\n            var routeArray = baseRoute.slice();\n            addRoute(routeArray, path, routes[path]);\n            if (matcher.children[path]) {\n              eachRoute(routeArray, matcher.children[path], callback, binding);\n            } else {\n              callback.call(binding, routeArray);\n            }\n          }\n        }\n      }\n      return function(callback, addRouteCallback) {\n        var matcher = new Matcher();\n        callback(generateMatch(\"\", matcher, this.delegate));\n        eachRoute([], matcher, function(route) {\n          if (addRouteCallback) {\n            addRouteCallback(this, route);\n          } else {\n            this.add(route);\n          }\n        }, this);\n      };\n    }());\n    var specials = ['/', '.', '*', '+', '?', '|', '(', ')', '[', ']', '{', '}', '\\\\'];\n    var escapeRegex = new RegExp('(\\\\' + specials.join('|\\\\') + ')', 'g');\n    function isArray(test) {\n      return Object.prototype.toString.call(test) === \"[object Array]\";\n    }\n    function StaticSegment(string) {\n      this.string = string;\n    }\n    StaticSegment.prototype = {\n      eachChar: function(callback) {\n        var string = this.string,\n            ch;\n        for (var i = 0,\n            l = string.length; i < l; i++) {\n          ch = string.charAt(i);\n          callback({validChars: ch});\n        }\n      },\n      regex: function() {\n        return this.string.replace(escapeRegex, '\\\\$1');\n      },\n      generate: function() {\n        return this.string;\n      }\n    };\n    function DynamicSegment(name) {\n      this.name = name;\n    }\n    DynamicSegment.prototype = {\n      eachChar: function(callback) {\n        callback({\n          invalidChars: \"/\",\n          repeat: true\n        });\n      },\n      regex: function() {\n        return \"([^/]+)\";\n      },\n      generate: function(params) {\n        return params[this.name];\n      }\n    };\n    function StarSegment(name) {\n      this.name = name;\n    }\n    StarSegment.prototype = {\n      eachChar: function(callback) {\n        callback({\n          invalidChars: \"\",\n          repeat: true\n        });\n      },\n      regex: function() {\n        return \"(.+)\";\n      },\n      generate: function(params) {\n        return params[this.name];\n      }\n    };\n    function EpsilonSegment() {}\n    EpsilonSegment.prototype = {\n      eachChar: function() {},\n      regex: function() {\n        return \"\";\n      },\n      generate: function() {\n        return \"\";\n      }\n    };\n    function parse(route, names, types) {\n      if (route.charAt(0) === \"/\") {\n        route = route.substr(1);\n      }\n      var segments = route.split(\"/\"),\n          results = [];\n      for (var i = 0,\n          l = segments.length; i < l; i++) {\n        var segment = segments[i],\n            match;\n        if (match = segment.match(/^:([^\\/]+)$/)) {\n          results.push(new DynamicSegment(match[1]));\n          names.push(match[1]);\n          types.dynamics++;\n        } else if (match = segment.match(/^\\*([^\\/]+)$/)) {\n          results.push(new StarSegment(match[1]));\n          names.push(match[1]);\n          types.stars++;\n        } else if (segment === \"\") {\n          results.push(new EpsilonSegment());\n        } else {\n          results.push(new StaticSegment(segment));\n          types.statics++;\n        }\n      }\n      return results;\n    }\n    function State(charSpec) {\n      this.charSpec = charSpec;\n      this.nextStates = [];\n    }\n    State.prototype = {\n      get: function(charSpec) {\n        var nextStates = this.nextStates;\n        for (var i = 0,\n            l = nextStates.length; i < l; i++) {\n          var child = nextStates[i];\n          var isEqual = child.charSpec.validChars === charSpec.validChars;\n          isEqual = isEqual && child.charSpec.invalidChars === charSpec.invalidChars;\n          if (isEqual) {\n            return child;\n          }\n        }\n      },\n      put: function(charSpec) {\n        var state;\n        if (state = this.get(charSpec)) {\n          return state;\n        }\n        state = new State(charSpec);\n        this.nextStates.push(state);\n        if (charSpec.repeat) {\n          state.nextStates.push(state);\n        }\n        return state;\n      },\n      match: function(ch) {\n        var nextStates = this.nextStates,\n            child,\n            charSpec,\n            chars;\n        var returned = [];\n        for (var i = 0,\n            l = nextStates.length; i < l; i++) {\n          child = nextStates[i];\n          charSpec = child.charSpec;\n          if (typeof(chars = charSpec.validChars) !== 'undefined') {\n            if (chars.indexOf(ch) !== -1) {\n              returned.push(child);\n            }\n          } else if (typeof(chars = charSpec.invalidChars) !== 'undefined') {\n            if (chars.indexOf(ch) === -1) {\n              returned.push(child);\n            }\n          }\n        }\n        return returned;\n      }\n    };\n    function sortSolutions(states) {\n      return states.sort(function(a, b) {\n        if (a.types.stars !== b.types.stars) {\n          return a.types.stars - b.types.stars;\n        }\n        if (a.types.stars) {\n          if (a.types.statics !== b.types.statics) {\n            return b.types.statics - a.types.statics;\n          }\n          if (a.types.dynamics !== b.types.dynamics) {\n            return b.types.dynamics - a.types.dynamics;\n          }\n        }\n        if (a.types.dynamics !== b.types.dynamics) {\n          return a.types.dynamics - b.types.dynamics;\n        }\n        if (a.types.statics !== b.types.statics) {\n          return b.types.statics - a.types.statics;\n        }\n        return 0;\n      });\n    }\n    function recognizeChar(states, ch) {\n      var nextStates = [];\n      for (var i = 0,\n          l = states.length; i < l; i++) {\n        var state = states[i];\n        nextStates = nextStates.concat(state.match(ch));\n      }\n      return nextStates;\n    }\n    var oCreate = Object.create || function(proto) {\n      function F() {}\n      F.prototype = proto;\n      return new F();\n    };\n    function RecognizeResults(queryParams) {\n      this.queryParams = queryParams || {};\n    }\n    RecognizeResults.prototype = oCreate({\n      splice: Array.prototype.splice,\n      slice: Array.prototype.slice,\n      push: Array.prototype.push,\n      length: 0,\n      queryParams: null\n    });\n    function findHandler(state, path, queryParams) {\n      var handlers = state.handlers,\n          regex = state.regex;\n      var captures = path.match(regex),\n          currentCapture = 1;\n      var result = new RecognizeResults(queryParams);\n      for (var i = 0,\n          l = handlers.length; i < l; i++) {\n        var handler = handlers[i],\n            names = handler.names,\n            params = {};\n        for (var j = 0,\n            m = names.length; j < m; j++) {\n          params[names[j]] = captures[currentCapture++];\n        }\n        result.push({\n          handler: handler.handler,\n          params: params,\n          isDynamic: !!names.length\n        });\n      }\n      return result;\n    }\n    function addSegment(currentState, segment) {\n      segment.eachChar(function(ch) {\n        var state;\n        currentState = currentState.put(ch);\n      });\n      return currentState;\n    }\n    var RouteRecognizer = function() {\n      this.rootState = new State();\n      this.names = {};\n    };\n    RouteRecognizer.prototype = {\n      add: function(routes, options) {\n        var currentState = this.rootState,\n            regex = \"^\",\n            types = {\n              statics: 0,\n              dynamics: 0,\n              stars: 0\n            },\n            handlers = [],\n            allSegments = [],\n            name;\n        var isEmpty = true;\n        for (var i = 0,\n            l = routes.length; i < l; i++) {\n          var route = routes[i],\n              names = [];\n          var segments = parse(route.path, names, types);\n          allSegments = allSegments.concat(segments);\n          for (var j = 0,\n              m = segments.length; j < m; j++) {\n            var segment = segments[j];\n            if (segment instanceof EpsilonSegment) {\n              continue;\n            }\n            isEmpty = false;\n            currentState = currentState.put({validChars: \"/\"});\n            regex += \"/\";\n            currentState = addSegment(currentState, segment);\n            regex += segment.regex();\n          }\n          var handler = {\n            handler: route.handler,\n            names: names\n          };\n          handlers.push(handler);\n        }\n        if (isEmpty) {\n          currentState = currentState.put({validChars: \"/\"});\n          regex += \"/\";\n        }\n        currentState.handlers = handlers;\n        currentState.regex = new RegExp(regex + \"$\");\n        currentState.types = types;\n        if (name = options && options.as) {\n          this.names[name] = {\n            segments: allSegments,\n            handlers: handlers\n          };\n        }\n      },\n      handlersFor: function(name) {\n        var route = this.names[name],\n            result = [];\n        if (!route) {\n          throw new Error(\"There is no route named \" + name);\n        }\n        for (var i = 0,\n            l = route.handlers.length; i < l; i++) {\n          result.push(route.handlers[i]);\n        }\n        return result;\n      },\n      hasRoute: function(name) {\n        return !!this.names[name];\n      },\n      generate: function(name, params) {\n        var route = this.names[name],\n            output = \"\";\n        if (!route) {\n          throw new Error(\"There is no route named \" + name);\n        }\n        var segments = route.segments;\n        for (var i = 0,\n            l = segments.length; i < l; i++) {\n          var segment = segments[i];\n          if (segment instanceof EpsilonSegment) {\n            continue;\n          }\n          output += \"/\";\n          output += segment.generate(params);\n        }\n        if (output.charAt(0) !== '/') {\n          output = '/' + output;\n        }\n        if (params && params.queryParams) {\n          output += this.generateQueryString(params.queryParams, route.handlers);\n        }\n        return output;\n      },\n      generateQueryString: function(params, handlers) {\n        var pairs = [];\n        var keys = [];\n        for (var key in params) {\n          if (params.hasOwnProperty(key)) {\n            keys.push(key);\n          }\n        }\n        keys.sort();\n        for (var i = 0,\n            len = keys.length; i < len; i++) {\n          key = keys[i];\n          var value = params[key];\n          if (value == null) {\n            continue;\n          }\n          var pair = encodeURIComponent(key);\n          if (isArray(value)) {\n            for (var j = 0,\n                l = value.length; j < l; j++) {\n              var arrayPair = key + '[]' + '=' + encodeURIComponent(value[j]);\n              pairs.push(arrayPair);\n            }\n          } else {\n            pair += \"=\" + encodeURIComponent(value);\n            pairs.push(pair);\n          }\n        }\n        if (pairs.length === 0) {\n          return '';\n        }\n        return \"?\" + pairs.join(\"&\");\n      },\n      parseQueryString: function(queryString) {\n        var pairs = queryString.split(\"&\"),\n            queryParams = {};\n        for (var i = 0; i < pairs.length; i++) {\n          var pair = pairs[i].split('='),\n              key = decodeURIComponent(pair[0]),\n              keyLength = key.length,\n              isArray = false,\n              value;\n          if (pair.length === 1) {\n            value = 'true';\n          } else {\n            if (keyLength > 2 && key.slice(keyLength - 2) === '[]') {\n              isArray = true;\n              key = key.slice(0, keyLength - 2);\n              if (!queryParams[key]) {\n                queryParams[key] = [];\n              }\n            }\n            value = pair[1] ? decodeURIComponent(pair[1]) : '';\n          }\n          if (isArray) {\n            queryParams[key].push(value);\n          } else {\n            queryParams[key] = value;\n          }\n        }\n        return queryParams;\n      },\n      recognize: function(path) {\n        var states = [this.rootState],\n            pathLen,\n            i,\n            l,\n            queryStart,\n            queryParams = {},\n            isSlashDropped = false;\n        queryStart = path.indexOf('?');\n        if (queryStart !== -1) {\n          var queryString = path.substr(queryStart + 1, path.length);\n          path = path.substr(0, queryStart);\n          queryParams = this.parseQueryString(queryString);\n        }\n        path = decodeURI(path);\n        if (path.charAt(0) !== \"/\") {\n          path = \"/\" + path;\n        }\n        pathLen = path.length;\n        if (pathLen > 1 && path.charAt(pathLen - 1) === \"/\") {\n          path = path.substr(0, pathLen - 1);\n          isSlashDropped = true;\n        }\n        for (i = 0, l = path.length; i < l; i++) {\n          states = recognizeChar(states, path.charAt(i));\n          if (!states.length) {\n            break;\n          }\n        }\n        var solutions = [];\n        for (i = 0, l = states.length; i < l; i++) {\n          if (states[i].handlers) {\n            solutions.push(states[i]);\n          }\n        }\n        states = sortSolutions(solutions);\n        var state = solutions[0];\n        if (state && state.handlers) {\n          if (isSlashDropped && state.regex.source.slice(-5) === \"(.+)$\") {\n            path = path + \"/\";\n          }\n          return findHandler(state, path, queryParams);\n        }\n      }\n    };\n    RouteRecognizer.prototype.map = map;\n    RouteRecognizer.VERSION = 'VERSION_STRING_PLACEHOLDER';\n    return RouteRecognizer;\n  }());\nvar CHILD_ROUTE_SUFFIX = '/*childRoute';\nvar Grammar = function Grammar() {\n    this.rules = {};\n  };\n(createClass)(Grammar, {\n    config: function(name, config) {\n      if (name === 'app') {\n        name = '/';\n      }\n      if (!this.rules[name]) {\n        this.rules[name] = new CanonicalRecognizer(name);\n      }\n      this.rules[name].config(config);\n    },\n    recognize: function(url) {\n      var componentName = arguments[1] !== (void 0) ? arguments[1] : '/';\n      var $__0 = this;\n      if (typeof url === 'undefined') {\n        return;\n      }\n      var componentRecognizer = this.rules[componentName];\n      if (!componentRecognizer) {\n        return;\n      }\n      var context = componentRecognizer.recognize(url);\n      if (!context) {\n        return;\n      }\n      var lastContextChunk = context[context.length - 1];\n      var lastHandler = lastContextChunk.handler;\n      var lastParams = lastContextChunk.params;\n      var instruction = {\n        viewports: {},\n        params: lastParams\n      };\n      if (lastParams && lastParams.childRoute) {\n        var childUrl = '/' + lastParams.childRoute;\n        instruction.canonicalUrl = lastHandler.rewroteUrl.substr(0, lastHandler.rewroteUrl.length - (lastParams.childRoute.length + 1));\n        forEach(lastHandler.components, (function(componentName, viewportName) {\n          instruction.viewports[viewportName] = $__0.recognize(childUrl, componentName);\n        }));\n        instruction.canonicalUrl += instruction.viewports[Object.keys(instruction.viewports)[0]].canonicalUrl;\n      } else {\n        instruction.canonicalUrl = lastHandler.rewroteUrl;\n        forEach(lastHandler.components, (function(componentName, viewportName) {\n          instruction.viewports[viewportName] = {viewports: {}};\n        }));\n      }\n      forEach(instruction.viewports, (function(instruction, componentName) {\n        instruction.component = lastHandler.components[componentName];\n        instruction.params = lastParams;\n      }));\n      return instruction;\n    },\n    generate: function(name, params) {\n      var path = '';\n      var solution;\n      do {\n        solution = null;\n        forEach(this.rules, (function(recognizer) {\n          if (recognizer.hasRoute(name)) {\n            path = recognizer.generate(name, params) + path;\n            solution = recognizer;\n          }\n        }));\n        if (!solution) {\n          return '';\n        }\n        name = solution.name;\n      } while (solution.name !== '/');\n      return path;\n    }\n  }, {});\nObject.defineProperty(Grammar.prototype.recognize, \"parameters\", {get: function() {\n      return [[$traceurRuntime.type.string], []];\n    }});\nvar CanonicalRecognizer = function CanonicalRecognizer(name) {\n    this.name = name;\n    this.rewrites = {};\n    this.recognizer = new RouteRecognizer();\n  };\n(createClass)(CanonicalRecognizer, {\n    config: function(mapping) {\n      var $__0 = this;\n      if (mapping instanceof Array) {\n        mapping.forEach((function(nav) {\n          return $__0.configOne(nav);\n        }));\n      } else {\n        this.configOne(mapping);\n      }\n    },\n    getCanonicalUrl: function(url) {\n      if (url[0] === '.') {\n        url = url.substr(1);\n      }\n      if (url === '' || url[0] !== '/') {\n        url = '/' + url;\n      }\n      forEach(this.rewrites, function(toUrl, fromUrl) {\n        if (fromUrl === '/') {\n          if (url === '/') {\n            url = toUrl;\n          }\n        } else if (url.indexOf(fromUrl) === 0) {\n          url = url.replace(fromUrl, toUrl);\n        }\n      });\n      return url;\n    },\n    configOne: function(mapping) {\n      var $__0 = this;\n      if (mapping.redirectTo) {\n        if (this.rewrites[mapping.path]) {\n          throw new Error('\"' + mapping.path + '\" already maps to \"' + this.rewrites[mapping.path] + '\"');\n        }\n        this.rewrites[mapping.path] = mapping.redirectTo;\n        return;\n      }\n      if (mapping.component) {\n        if (mapping.components) {\n          throw new Error('A route config should have either a \"component\" or \"components\" property, but not both.');\n        }\n        mapping.components = mapping.component;\n        delete mapping.component;\n      }\n      if (typeof mapping.components === 'string') {\n        mapping.components = {default: mapping.components};\n      }\n      var aliases;\n      if (mapping.as) {\n        aliases = [mapping.as];\n      } else {\n        aliases = mapObj(mapping.components, (function(componentName, viewportName) {\n          return viewportName + ':' + componentName;\n        }));\n        if (mapping.components.default) {\n          aliases.push(mapping.components.default);\n        }\n      }\n      aliases.forEach((function(alias) {\n        return $__0.recognizer.add([{\n          path: mapping.path,\n          handler: mapping\n        }], {as: alias});\n      }));\n      var withChild = copy(mapping);\n      withChild.path += CHILD_ROUTE_SUFFIX;\n      this.recognizer.add([{\n        path: withChild.path,\n        handler: withChild\n      }]);\n    },\n    recognize: function(url) {\n      var canonicalUrl = this.getCanonicalUrl(url);\n      var context = this.recognizer.recognize(canonicalUrl);\n      if (context) {\n        context[0].handler.rewroteUrl = canonicalUrl;\n      }\n      return context;\n    },\n    generate: function(name, params) {\n      return this.recognizer.generate(name, params);\n    },\n    hasRoute: function(name) {\n      return this.recognizer.hasRoute(name);\n    }\n  }, {});\nfunction copy(obj) {\n    return JSON.parse(JSON.stringify(obj));\n  }\nfunction forEach(obj, fn) {\n    Object.keys(obj).forEach((function(key) {\n      return fn(obj[key], key);\n    }));\n  }\nfunction mapObj(obj, fn) {\n    var result = [];\n    Object.keys(obj).forEach((function(key) {\n      return result.push(fn(obj[key], key));\n    }));\n    return result;\n  }\nreturn new Grammar();\n}]);\n"],"sourceRoot":"/source/"}